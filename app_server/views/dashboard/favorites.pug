extends ../layout

block content
  .container.my-4
    // Breadcrumb
    nav(aria-label="breadcrumb")
      ol.breadcrumb
        li.breadcrumb-item
          a(href="/") Inicio
        li.breadcrumb-item.active(aria-current="page") Mis Favoritos

    // Page Header
    .row.mb-4
      .col-md-8
        .d-flex.align-items-center
          .bg-danger.rounded-circle.d-flex.align-items-center.justify-content-center.me-3(style="width: 60px; height: 60px;")
            i.bi.bi-heart-fill.text-white.fs-3
          div
            h2.fw-bold.mb-1 Mis Favoritos
            p.text-muted.mb-0 Items que te interesan
      .col-md-4.text-md-end
        a.btn.btn-outline-primary(href="/me/items")
          i.bi.bi-collection.me-2
          | Ver Mis Items

    // Favorites Grid
    if favorites.length > 0
      .row
        each item in favorites
          .col-md-6.col-lg-4.mb-4
            .card.h-100.border-0.shadow-sm
              .position-relative
                img.card-img-top(src=item.images && item.images.length > 0 ? item.images[0] : '/images/placeholder.jpg', alt=item.title, style="height: 200px; object-fit: cover;")
                .position-absolute.top-0.end-0.m-2
                  button.btn.btn-light.btn-sm.rounded-circle(onclick=`removeFavorite('${item.watchlistId}')`)
                    i.bi.bi-heart-fill.text-danger

              .card-body.d-flex.flex-column
                h6.card-title.fw-bold= item.title
                p.card-text.text-muted.small.flex-grow-1= item.description
                
                .d-flex.justify-content-between.align-items-center.mb-3
                  span.h5.text-primary.mb-0 $#{item.price}
                  small.text-muted= item.category

                .d-grid.gap-2.mt-auto
                  a.btn.btn-primary.btn-sm(href=`/items/${item._id}`) Ver Detalles
                  a.btn.btn-outline-success.btn-sm(
                    href=`https://wa.me/593999999999?text=Hola! Vi tu publicación en CampusSwap: ${item.title}. ¿Está disponible?`,
                    target="_blank"
                  )
                    i.bi.bi-whatsapp.me-1
                    | Contactar
    else
      .row
        .col-12.text-center.py-5
          .bg-light.rounded.p-5
            i.bi.bi-heart.fs-1.text-muted.mb-3
            h4.text-muted No tienes favoritos guardados
            p.text-muted.mb-4 Explora items y guarda los que te interesen
            a.btn.btn-primary.btn-lg(href="/")
              i.bi.bi-search.me-2
              | Explorar Items

  // JavaScript for favorites functionality
  script.
    function removeFavorite(watchlistId) {
      if (!watchlistId) return;
      if (confirm('¿Quitar este item de tus favoritos?')) {
        // Create form and submit to remove endpoint
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/me/favorites/${watchlistId}/remove`;
        document.body.appendChild(form);
        form.submit();
      }
    }